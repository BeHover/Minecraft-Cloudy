<!DOCTYPE html>
<html lang="ru">
<head>
    {{ include('include/head.html.twig') }}
    <title>{% block title %}Служба поддержки{% endblock %}</title>
</head>
<body>
    {{ include('include/preloader.html.twig') }}
    {{ include('include/nav.html.twig') }}
    {{ include('badges/header.html.twig') }}

    <section id="main-content" class="landing-block landing-padding wow animate__animated animate__fadeIn animate__delay-1s">
        <div class="container container-wiki">
            <div class="row">
                <div class="d-none d-xxl-block col-xxl-3 mb-4 mb-lg-0">
                    <div class="nav flex-column nav-pills">
                        <a class="nav-link" href="{{ path('support', {'page': 'main'}) }}">Вики Minecraft Cloudy</a>
                        <div class="divider"></div>
                        <a class="nav-link" href="{{ path('support', {'page': 'faq'}) }}">Частые вопросы</a>
                        <a class="nav-link" href="{{ path('support', {'page': 'profile'}) }}">Управление аккаунтом</a>
                        <div class="divider"></div>
                        <a class="nav-link active" href="{{ path('user_reports') }}">Мои тикеты</a>
                        <a class="nav-link" href="{{ path('create_report') }}">Создать тикет</a>
                    </div>
                </div>
                <div class="col-12 col-xxl-9">
                    <a class="d-xxl-none back" href="{{ path('user_reports') }}">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.29289 13.7071C5.68342 14.0976 6.31658 14.0976 6.70711 13.7071C7.09763 13.3166 7.09763 12.6834 6.70711 12.2929L3.41421 9L15 9C15.5523 9 16 8.55228 16 8C16 7.44772 15.5523 7 15 7L3.41421 7L6.70711 3.70711C7.09763 3.31658 7.09763 2.68342 6.70711 2.29289C6.31658 1.90237 5.68342 1.90237 5.29289 2.29289L0.292893 7.29289C-0.0976328 7.68342 -0.0976329 8.31658 0.292893 8.70711L5.29289 13.7071Z" fill="#79797A"></path></svg>
                        Вернуться назад
                    </a>
                    <div class="wiki-display d-block">
                        {% if not app.user %}
                            <div class="wiki-banner">
                                <h4>Вы не авторизированы</h4>
                                <p>Авторизируйтесь, чтобы получить доступ к полному функционалу сайта.</p>
                            </div>
                        {% else %}
                            <div class="profile">
                                <img src="https://mc-cloudy.com/public/images/design/avatars/{{ report.getReporter().getIcon() }}" alt="{{ report.getReporter().getUsername() }} avatar" class="img-fluid rounded-circle mt-0" style="width: 40px; height: 40px; border-radius: .5rem!important" draggable="false" />
                                <div class="profile-text">
                                    <h5>{{ report.getReporter().getUsername() }}</h5>
                                    <p>
                                        {{ include('include/roles.html.twig') }}
                                    </p>
                                </div>
                                <p class="ml-auto d-none d-md-block">{{ report.getCreatedAt().format('d.m.Y, H:i') }}</p>
                            </div>

                            <div class="divider"></div>

                            <h4 class="d-flex">
                                #{{ report.getId() }} <span class="mx-2">—</span> {{ report.getType().getName() }}
                                <ul class="d-none d-lg-block">
                                    <li>Феникс</li>
                                </ul>
                            </h4>

                            {% if report.getImages()|length > 0 %}
                                <p class="mb-3">{{ report.getText() }}</p>

                                <h5><i class="bi bi-arrow-return-right"></i>Прикреплённые файлы:</h5>
                                <div class="row">
                                    {% for image in report.getImages() %}
                                        <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
                                            <a class="wiki-link" href="https://mc-cloudy.com/public/images/reports/{{ image }}" target="_blank">
                                            <span class="wiki-content" style="padding: 14px 20px">
                                                <span class="wiki-link-header">
                                                    <span>
                                                        Вложение <span class="mx-2">—</span> #{{ loop.index }}
                                                    </span>
                                                    <svg class="icon-secondary" width="16" height="16" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 4C2 2.89543 2.89543 2 4 2H11C11.5523 2 12 1.55228 12 1C12 0.447715 11.5523 0 11 0H4C1.79086 0 0 1.79086 0 4V18C0 20.2091 1.79086 22 4 22H18C20.2091 22 22 20.2091 22 18V11C22 10.4477 21.5523 10 21 10C20.4477 10 20 10.4477 20 11V18C20 19.1046 19.1046 20 18 20H4C2.89543 20 2 19.1046 2 18V4Z"></path><path d="M15 0C14.4477 0 14 0.447715 14 1C14 1.55228 14.4477 2 15 2H18.5858L6.29289 14.2929C5.90237 14.6834 5.90237 15.3166 6.29289 15.7071C6.68342 16.0976 7.31658 16.0976 7.70711 15.7071L20 3.41421V7C20 7.55228 20.4477 8 21 8C21.5523 8 22 7.55228 22 7V1C22 0.447715 21.5523 0 21 0H15Z"></path></svg>
                                                </span>
                                                <p style="line-height: 24px">Нажмите для просмотра</p>
                                            </span>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="mb-2">{{ report.getText() }}</p>
                            {% endif %}

                            {% if report.getStatus() == 1 %}
                                <div class="divider {% if report.getImages()|length > 0 %} mt-0 {% else %} mt-3 {% endif %}"></div>

                                <div class="wiki-banner mt-4 mb-2">
                                    <h4 style="margin: 0!important">Ответ от службы поддержки:</h4>
                                    <p>{{ report.getResponse() }}</p>
                                </div>
                            {% endif %}

                            <div class="row d-flex justify-content-center justify-content-xl-end" style="padding: 0 .7rem">
                                {% if report.getStatus() == 0 %}
                                    <a href="{{ path('user_update_report', {'id': report.getId()}) }}" class="btn btn-secondary col-12 col-md-auto me-0 me-md-3">Внести изменения</a>
                                {% endif %}

                                <a href="{{ path('user_delete_report', {'id': report.getId()}) }}" class="btn btn-primary col-12 col-md-auto">Удалить тикет</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{ include('include/footer.html.twig') }}
</body>
